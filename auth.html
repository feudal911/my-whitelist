<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autentica√ß√£o - Whitelist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'red-custom': {
                            50: '#fef2f2',
                            100: '#fee2e2',
                            200: '#fecaca',
                            300: '#fca5a5',
                            400: '#f87171',
                            500: '#ef4444',
                            600: '#dc2626',
                            700: '#b91c1c',
                            800: '#991b1b',
                            900: '#7f1d1d',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-switch {
            transition: all 0.3s ease;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-red-50 to-white min-h-screen">
    <div class="container mx-auto px-4 max-w-md py-20">
        <!-- Logo e T√≠tulo -->
        <div class="text-center mb-12">
            <h1 class="text-5xl font-bold text-red-600 mb-4">Whitelist</h1>
            <p class="text-xl text-gray-600">Sua lista de desejos na nuvem</p>
        </div>

        <!-- Container de Autentica√ß√£o -->
        <div class="bg-white rounded-3xl shadow-xl p-8 border border-red-100">
            <!-- Tabs de Login/Registro -->
            <div class="flex mb-8 bg-gray-100 rounded-2xl p-1">
                <button 
                    id="loginTab" 
                    onclick="switchTab('login')"
                    class="flex-1 py-3 px-6 rounded-xl font-semibold transition-all duration-200 tab-active"
                >
                    üîê Entrar
                </button>
                <button 
                    id="registerTab" 
                    onclick="switchTab('register')"
                    class="flex-1 py-3 px-6 rounded-xl font-semibold transition-all duration-200"
                >
                    ‚ú® Registrar
                </button>
            </div>

            <!-- Formul√°rio de Login -->
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-red-600 font-semibold mb-3">
                        Email
                    </label>
                    <input 
                        type="email" 
                        id="loginEmail" 
                        required
                        placeholder="seu@email.com"
                        class="w-full px-4 py-3 border-2 border-red-200 rounded-xl focus:border-red-500 focus:outline-none transition-colors text-gray-700"
                    >
                </div>
                
                <div>
                    <label class="block text-red-600 font-semibold mb-3">
                        Senha
                    </label>
                    <input 
                        type="password" 
                        id="loginPassword" 
                        required
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                        class="w-full px-4 py-3 border-2 border-red-200 rounded-xl focus:border-red-500 focus:outline-none transition-colors text-gray-700"
                    >
                </div>
                
                <button 
                    type="submit" 
                    id="loginButton"
                    class="w-full gradient-bg text-white py-4 px-6 rounded-2xl text-xl font-semibold hover:scale-105 transition-transform duration-200 shadow-lg"
                >
                    üöÄ Entrar
                </button>
                
                <div class="text-center">
                    <button 
                        type="button" 
                        onclick="forgotPassword()"
                        class="text-red-600 hover:text-red-700 text-sm font-medium"
                    >
                        Esqueceu a senha?
                    </button>
                </div>
            </form>

            <!-- Formul√°rio de Registro -->
            <form id="registerForm" class="space-y-6 hidden">
                <div>
                    <label class="block text-red-600 font-semibold mb-3">
                        Nome Completo
                    </label>
                    <input 
                        type="text" 
                        id="registerName" 
                        required
                        placeholder="Seu nome completo"
                        class="w-full px-4 py-3 border-2 border-red-200 rounded-xl focus:border-red-500 focus:outline-none transition-colors text-gray-700"
                    >
                </div>
                
                <div>
                    <label class="block text-red-600 font-semibold mb-3">
                        Email
                    </label>
                    <input 
                        type="email" 
                        id="registerEmail" 
                        required
                        placeholder="seu@email.com"
                        class="w-full px-4 py-3 border-2 border-red-200 rounded-xl focus:border-red-500 focus:outline-none transition-colors text-gray-700"
                    >
                </div>
                
                <div>
                    <label class="block text-red-600 font-semibold mb-3">
                        Senha
                    </label>
                    <input 
                        type="password" 
                        id="registerPassword" 
                        required
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                        class="w-full px-4 py-3 border-2 border-red-200 rounded-xl focus:border-red-500 focus:outline-none transition-colors text-gray-700"
                    >
                </div>
                
                <div>
                    <label class="block text-red-600 font-semibold mb-3">
                        Confirmar Senha
                    </label>
                    <input 
                        type="password" 
                        id="registerConfirmPassword" 
                        required
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                        class="w-full px-4 py-3 border-2 border-red-200 rounded-xl focus:border-red-500 focus:outline-none transition-colors text-gray-700"
                    >
                </div>
                
                <button 
                    type="submit" 
                    id="registerButton"
                    class="w-full gradient-bg text-white py-4 px-6 rounded-2xl text-xl font-semibold hover:scale-105 transition-transform duration-200 shadow-lg"
                >
                    ‚ú® Criar Conta
                </button>
            </form>

            <!-- Estado de Loading -->
            <div id="loadingState" class="text-center py-8 hidden">
                <div class="loading mx-auto mb-4"></div>
                <p class="text-gray-600">Processando...</p>
            </div>

            <!-- Mensagens de Erro/Sucesso -->
            <div id="messageBox" class="mt-6 p-4 rounded-xl hidden"></div>
        </div>

        <!-- Footer -->
        <div class="text-center mt-8 text-gray-500">
            <p>‚ú® Organize seus desejos de forma inteligente</p>
        </div>
    </div>

    <script>
        // Inicializar Supabase
        const supabaseClient = window.supabase.createClient(SUPABASE_CONFIG.URL, SUPABASE_CONFIG.ANON_KEY);
        
        let currentTab = 'login';

        // Fun√ß√£o para alternar entre tabs
        function switchTab(tab) {
            currentTab = tab;
            
            // Atualizar bot√µes
            document.getElementById('loginTab').classList.toggle('tab-active', tab === 'login');
            document.getElementById('registerTab').classList.toggle('tab-active', tab === 'register');
            
            // Atualizar formul√°rios
            document.getElementById('loginForm').classList.toggle('hidden', tab !== 'login');
            document.getElementById('registerForm').classList.toggle('hidden', tab !== 'register');
            
            // Limpar mensagens
            hideMessage();
        }

        // Fun√ß√£o para mostrar mensagens
        function showMessage(message, type = 'info') {
            const messageBox = document.getElementById('messageBox');
            const colors = {
                success: 'bg-green-100 text-green-800 border-green-200',
                error: 'bg-red-100 text-red-800 border-red-200',
                info: 'bg-blue-100 text-blue-800 border-blue-200'
            };
            
            messageBox.className = `mt-6 p-4 rounded-xl border ${colors[type]} fade-in`;
            messageBox.textContent = message;
            messageBox.classList.remove('hidden');
        }

        function hideMessage() {
            document.getElementById('messageBox').classList.add('hidden');
        }

        // Fun√ß√£o para mostrar/esconder loading
        function toggleLoading(show) {
            document.getElementById('loadingState').classList.toggle('hidden', !show);
            document.getElementById('loginForm').classList.toggle('hidden', show);
            document.getElementById('registerForm').classList.toggle('hidden', show);
        }

        // Login
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                toggleLoading(true);
                
                const { data, error } = await supabaseClient.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) throw error;

                showMessage('‚úÖ Login realizado com sucesso!', 'success');
                
                // Redirecionar para a aplica√ß√£o principal
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1500);
                
            } catch (error) {
                console.error('Erro no login:', error);
                showMessage(`‚ùå Erro: ${error.message}`, 'error');
                toggleLoading(false);
            }
        });

        // Registro
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            
            if (password !== confirmPassword) {
                showMessage('‚ùå As senhas n√£o coincidem!', 'error');
                return;
            }
            
            try {
                toggleLoading(true);
                
                const { data, error } = await supabaseClient.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: {
                            full_name: name
                        }
                    }
                });

                if (error) throw error;

                showMessage('‚úÖ Conta criada com sucesso! Verifique seu email para confirmar.', 'success');
                
                // Limpar formul√°rio
                document.getElementById('registerForm').reset();
                
                // Voltar para login
                setTimeout(() => {
                    switchTab('login');
                }, 2000);
                
            } catch (error) {
                console.error('Erro no registro:', error);
                showMessage(`‚ùå Erro: ${error.message}`, 'error');
            } finally {
                toggleLoading(false);
            }
        });

        // Esqueceu a senha
        async function forgotPassword() {
            const email = document.getElementById('loginEmail').value;
            
            if (!email) {
                showMessage('‚ùå Digite seu email primeiro!', 'error');
                return;
            }
            
            try {
                const { error } = await supabaseClient.auth.resetPasswordForEmail(email);
                
                if (error) throw error;
                
                showMessage('‚úÖ Email de recupera√ß√£o enviado! Verifique sua caixa de entrada.', 'success');
                
            } catch (error) {
                console.error('Erro ao enviar email:', error);
                showMessage(`‚ùå Erro: ${error.message}`, 'error');
            }
        }

        // Verificar se j√° est√° logado
        async function checkAuth() {
            const { data: { user } } = await supabaseClient.auth.getUser();
            
            if (user) {
                // J√° est√° logado, redirecionar
                window.location.href = 'index.html';
            }
        }

        // Verificar autentica√ß√£o ao carregar
        document.addEventListener('DOMContentLoaded', checkAuth);
    </script>

    <style>
        .tab-active {
            background: white;
            color: #dc2626;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #dc2626;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</body>
</html>
