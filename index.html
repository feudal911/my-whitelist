<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Desejos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'red-custom': {
                            50: '#fef2f2',
                            100: '#fee2e2',
                            200: '#fecaca',
                            300: '#fca5a5',
                            400: '#f87171',
                            500: '#ef4444',
                            600: '#dc2626',
                            700: '#b91c1c',
                            800: '#991b1b',
                            900: '#7f1d1d',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(220, 38, 38, 0.15);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 0;
            max-width: 90vw;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0,0,0,0.25);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #dc2626;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-red-50 to-white min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white py-8 mb-8">
        <div class="container mx-auto px-4 text-center">
            <h1 class="text-5xl md:text-6xl font-bold mb-4 drop-shadow-lg">
                 Whitelist
            </h1>
            <p class="text-xl md:text-2xl opacity-90">
                Itens que eu quero comprar
            </p>
            <div class="mt-4 text-sm opacity-75">
                ‚ú® S√≥ clicando na op√ß√£o de comprar
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 max-w-7xl">
        <!-- Formul√°rio para adicionar itens -->
        <div class="bg-white rounded-3xl shadow-xl p-8 mb-8 border border-red-100">
            <h2 class="text-3xl font-bold text-red-600 text-center mb-8">
                ‚ú® Adicionar Novo Item
            </h2>
            
            <form id="addItemForm" class="space-y-6">
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-red-600 font-semibold mb-3 text-lg">
                            Nome do Item *
                        </label>
                        <input 
                            type="text" 
                            id="itemTitle" 
                            required 
                            placeholder="Ex: iPhone 15 Pro Max"
                            class="w-full px-4 py-3 border-2 border-red-200 rounded-xl focus:border-red-500 focus:outline-none transition-colors text-gray-700"
                        >
                    </div>
                    
                    <div>
                        <label class="block text-red-600 font-semibold mb-3 text-lg">
                            Pre√ßo
                        </label>
                        <input 
                            type="text" 
                            id="itemPrice" 
                            placeholder="R$ 0,00"
                            class="w-full px-4 py-3 border-2 border-red-200 rounded-xl focus:border-red-500 focus:outline-none transition-colors text-gray-700"
                        >
                    </div>
                </div>
                
                <div>
                    <label class="block text-red-600 font-semibold mb-3 text-lg">
                        Descri√ß√£o
                    </label>
                    <textarea 
                        id="itemDescription" 
                        rows="3" 
                        placeholder="Descreva o item, especifica√ß√µes, cor preferida..."
                        class="w-full px-4 py-3 border-2 border-red-200 rounded-xl focus:border-red-500 focus:outline-none transition-colors text-gray-700 resize-none"
                    ></textarea>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-red-600 font-semibold mb-3 text-lg">
                            URL da Imagem
                        </label>
                        <input 
                            type="url" 
                            id="itemImage" 
                            placeholder="https://exemplo.com/imagem.jpg"
                            class="w-full px-4 py-3 border-2 border-red-200 rounded-xl focus:border-red-500 focus:outline-none transition-colors text-gray-700"
                        >
                    </div>
                    
                    <div>
                        <label class="block text-red-600 font-semibold mb-3 text-lg">
                            Link para Compra
                        </label>
                        <input 
                            type="url" 
                            id="itemLink" 
                            placeholder="https://exemplo.com/produto"
                            class="w-full px-4 py-3 border-2 border-red-200 rounded-xl focus:border-red-500 focus:outline-none transition-colors text-gray-700"
                        >
                    </div>
                    
                    <div>
                        <label class="block text-red-600 font-semibold mb-3 text-lg">
                            Categoria *
                        </label>
                        <select 
                            id="itemCategory" 
                            required
                            class="w-full px-4 py-3 border-2 border-red-200 rounded-xl focus:border-red-500 focus:outline-none transition-colors text-gray-700"
                        >
                            <option value="">Selecione uma categoria</option>
                            <option value="eletronicos">üéÆ Eletr√¥nicos</option>
                            <option value="roupas">üëï Roupas</option>
                            <option value="livros">üìö Livros</option>
                            <option value="casa">üè† Casa</option>
                            <option value="esportes">‚öΩ Esportes</option>
                            <option value="beleza">üíÑ Beleza</option>
                            <option value="outros">üéÅ Outros</option>
                        </select>
                    </div>
                </div>
                
                <div class="text-center">
                    <button 
                        type="submit" 
                        id="submitButton"
                        class="gradient-bg text-white px-12 py-4 rounded-2xl text-xl font-semibold hover:scale-105 transition-transform duration-200 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                        üéÅ Adicionar √† Lista
                    </button>
                </div>
            </form>
        </div>

        <!-- Estat√≠sticas -->
        <div class="bg-white rounded-3xl shadow-lg p-6 mb-8 border border-red-100">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                <div class="p-4">
                    <div class="text-3xl font-bold text-red-600" id="totalItems">0</div>
                    <div class="text-gray-600">Total de Itens</div>
                </div>
                <div class="p-4">
                    <div class="text-3xl font-bold text-red-600" id="totalValue">R$ 0,00</div>
                    <div class="text-gray-600">Valor Total</div>
                </div>
                <div class="p-4">
                    <div class="text-3xl font-bold text-red-600" id="completedItems">0</div>
                    <div class="text-gray-600">Itens Comprados</div>
                </div>
            </div>
        </div>

        <!-- Filtros e Busca -->
        <div class="bg-white rounded-3xl shadow-lg p-6 mb-8 border border-red-100">
            <h3 class="text-2xl font-bold text-red-600 mb-6 text-center">
                üîç Filtros e Busca
            </h3>
            
            <div class="grid md:grid-cols-3 gap-6">
                <!-- Busca por texto -->
                <div>
                    <label class="block text-red-600 font-semibold mb-3">
                        Buscar por nome
                    </label>
                    <input 
                        type="text" 
                        id="searchInput" 
                        placeholder="Digite para buscar..."
                        class="w-full px-4 py-3 border-2 border-red-200 rounded-xl focus:border-red-500 focus:outline-none transition-colors text-gray-700"
                    >
                </div>
                
                <!-- Filtro por categoria -->
                <div>
                    <label class="block text-red-600 font-semibold mb-3">
                        Filtrar por categoria
                    </label>
                    <select 
                        id="categoryFilter" 
                        class="w-full px-4 py-3 border-2 border-red-200 rounded-xl focus:border-red-500 focus:outline-none transition-colors text-gray-700"
                    >
                        <option value="">Todas as categorias</option>
                        <option value="eletronicos">üéÆ Eletr√¥nicos</option>
                        <option value="roupas">üëï Roupas</option>
                        <option value="livros">üìö Livros</option>
                        <option value="casa">üè† Casa</option>
                        <option value="esportes">‚öΩ Esportes</option>
                        <option value="beleza">üíÑ Beleza</option>
                        <option value="outros">üéÅ Outros</option>
                    </select>
                </div>
                
                <!-- Filtro por status -->
                <div>
                    <label class="block text-red-600 font-semibold mb-3">
                        Filtrar por status
                    </label>
                    <select 
                        id="statusFilter" 
                        class="w-full px-4 py-3 border-2 border-red-200 rounded-xl focus:border-red-500 focus:outline-none transition-colors text-gray-700"
                    >
                        <option value="">Todos os itens</option>
                        <option value="available">üõí Dispon√≠vel</option>
                        <option value="completed">‚úÖ Comprado</option>
                    </select>
                </div>
            </div>
            
            <!-- Bot√µes de a√ß√£o -->
            <div class="flex justify-center mt-6 space-x-4">
                <button 
                    onclick="applyFilters()" 
                    class="gradient-bg text-white px-8 py-3 rounded-xl font-semibold hover:scale-105 transition-transform duration-200 shadow-lg"
                >
                    üîç Aplicar Filtros
                </button>
                
                <button 
                    onclick="clearFilters()" 
                    class="bg-gray-500 text-white px-8 py-3 rounded-xl font-semibold hover:bg-gray-600 transition-colors shadow-lg"
                >
                    üóëÔ∏è Limpar Filtros
                </button>
            </div>
        </div>

        <!-- Loading state -->
        <div id="loadingState" class="text-center py-20">
            <div class="loading mx-auto mb-4"></div>
            <p class="text-gray-600">Carregando lista de desejos...</p>
        </div>

        <!-- Grade de itens -->
        <div id="wishlistGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-8 hidden">
            <!-- Os itens ser√£o adicionados aqui dinamicamente -->
        </div>

        <!-- Estado vazio -->
        <div id="emptyState" class="text-center py-20 hidden">
            <div class="text-8xl mb-6">üìù</div>
            <h3 class="text-3xl font-bold text-red-600 mb-4">
                Sua lista est√° vazia
            </h3>
            <p class="text-xl text-gray-600">
                Use o formul√°rio acima para adicionar seus primeiros desejos!
            </p>
        </div>
    </div>

    <!-- Modal para visualizar item -->
    <div id="itemModal" class="modal">
        <div class="modal-content w-full md:w-auto">
            <div class="relative">
                <!-- Bot√£o fechar -->
                <button 
                    onclick="closeModal()" 
                    class="absolute top-4 right-4 z-10 bg-white rounded-full p-2 shadow-lg hover:bg-gray-100 transition-colors"
                >
                    <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
                
                <div class="grid md:grid-cols-2 gap-0">
                    <!-- Imagem do item -->
                    <div class="bg-gray-100 min-h-[400px] flex items-center justify-center">
                        <img id="modalImage" src="" alt="" class="w-full h-full object-cover">
                        <div id="modalNoImage" class="text-gray-400 text-center hidden">
                            <svg class="w-24 h-24 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            <p>Sem imagem</p>
                        </div>
                    </div>
                    
                    <!-- Informa√ß√µes do item -->
                    <div class="p-8 bg-white">
                        <h2 id="modalTitle" class="text-3xl font-bold text-red-600 mb-4"></h2>
                        
                        <div id="modalPrice" class="text-2xl font-bold text-red-600 mb-6 hidden"></div>
                        
                        <div id="modalDescription" class="text-gray-700 text-lg mb-8 hidden"></div>
                        
                        <div class="space-y-4">
                            <button 
                                id="modalBuyButton" 
                                onclick="openBuyLink()" 
                                class="w-full gradient-bg text-white py-4 px-6 rounded-2xl text-xl font-semibold hover:scale-105 transition-transform duration-200 shadow-lg"
                            >
                                üõí Comprar Agora
                            </button>
                            
                            <button 
                                onclick="markAsCompleted()" 
                                class="w-full bg-green-500 text-white py-4 px-6 rounded-2xl text-xl font-semibold hover:bg-green-600 transition-colors shadow-lg"
                            >
                                ‚úÖ Marcar como Comprado
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configura√ß√£o do Supabase
        // URL vem do arquivo config.js
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhiYWZueGd0c2RhdGd0dG9heWRsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ5NzE5NzAsImV4cCI6MjA1MDU0Nzk3MH0.Ej8Ej8Ej8Ej8Ej8Ej8Ej8Ej8Ej8Ej8Ej8Ej8Ej8Ej8';
        
        // Inicializar Supabase
        const supabaseClient = window.supabase.createClient(SUPABASE_CONFIG.URL, SUPABASE_CONFIG.ANON_KEY);
        
        // Array para armazenar os itens da lista de desejos
        let wishlistItems = [];
        let currentModalItem = null;

        // Fun√ß√£o para adicionar um novo item
        async function addWishItem(item) {
            try {
                const submitButton = document.getElementById('submitButton');
                submitButton.disabled = true;
                submitButton.innerHTML = '<div class="loading mx-auto"></div> Salvando...';
                
                const { data, error } = await supabaseClient
                    .from('wishlist_items')
                    .insert([{
                        title: item.title,
                        description: item.description || null,
                        price: item.price || null,
                        image_url: item.image || null,
                        buy_link: item.link || null,
                        category: item.category || null,
                        completed: false
                    }])
                    .select();

                if (error) throw error;

                // Adicionar o item √† lista local
                const newItem = {
                    id: data[0].id,
                    title: item.title,
                    description: item.description,
                    price: item.price,
                    image: item.image,
                    link: item.link,
                    completed: false,
                    dateAdded: new Date().toISOString()
                };
                
                wishlistItems.push(newItem);
                renderWishlist();
                updateStats();
                
                // Feedback visual
                submitButton.innerHTML = '‚úÖ Adicionado!';
                submitButton.classList.add('bg-green-500');
                
                setTimeout(() => {
                    submitButton.innerHTML = 'üéÅ Adicionar √† Lista';
                    submitButton.classList.remove('bg-green-500');
                    submitButton.disabled = false;
                }, 2000);
                
            } catch (error) {
                console.error('Erro ao adicionar item:', error);
                alert('Erro ao adicionar item. Tente novamente.');
                submitButton.innerHTML = 'üéÅ Adicionar √† Lista';
                submitButton.disabled = false;
            }
        }

        // Fun√ß√£o para carregar itens do Supabase
        async function loadWishlistFromSupabase() {
            try {
                const { data, error } = await supabaseClient
                    .from('wishlist_items')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                wishlistItems = data.map(item => ({
                    id: item.id,
                    title: item.title,
                    description: item.description,
                    price: item.price,
                    image: item.image_url,
                    link: item.buy_link,
                    category: item.category || 'outros',
                    completed: item.completed,
                    dateAdded: item.created_at
                }));

                renderWishlist();
                updateStats();
                
                // Esconder loading e mostrar conte√∫do
                document.getElementById('loadingState').classList.add('hidden');
                
            } catch (error) {
                console.error('Erro ao carregar lista:', error);
                document.getElementById('loadingState').innerHTML = `
                    <div class="text-red-600 text-center">
                        <div class="text-6xl mb-4">‚ö†Ô∏è</div>
                        <h3 class="text-xl font-bold mb-2">Erro ao carregar lista</h3>
                        <p class="text-gray-600">Verifique sua conex√£o e tente novamente</p>
                        <button onclick="loadWishlistFromSupabase()" class="mt-4 px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                            Tentar Novamente
                        </button>
                    </div>
                `;
            }
        }

        // Fun√ß√£o para renderizar a lista
        function renderWishlist() {
            const grid = document.getElementById('wishlistGrid');
            const emptyState = document.getElementById('emptyState');
            
            if (wishlistItems.length === 0) {
                grid.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }
            
            grid.classList.remove('hidden');
            emptyState.classList.add('hidden');
            
            grid.innerHTML = wishlistItems.map((item, index) => `
                <div class="bg-white rounded-3xl shadow-lg p-6 border border-red-100 card-hover fade-in ${item.completed ? 'opacity-60' : ''}">
                    ${item.image ? 
                        `<img src="${item.image}" alt="${item.title}" class="w-full h-48 object-cover rounded-2xl mb-4 border-2 border-red-100" onerror="this.style.display='none'">` : 
                        `<div class="w-full h-48 bg-red-50 rounded-2xl mb-4 flex items-center justify-center border-2 border-red-100">
                            <svg class="w-16 h-16 text-red-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                        </div>`
                    }
                    
                    <h3 class="text-xl font-bold text-red-600 mb-3 ${item.completed ? 'line-through' : ''}">
                        ${item.title}
                    </h3>
                    
                    <!-- Categoria -->
                    <div class="mb-3">
                        <span class="inline-block bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-semibold">
                            ${getCategoryIcon(item.category)} ${getCategoryName(item.category)}
                        </span>
                    </div>
                    
                    ${item.description ? `<p class="text-gray-600 mb-3 line-clamp-2">${item.description}</p>` : ''}
                    
                    ${item.price ? `<p class="text-lg font-bold text-red-600 mb-4">${item.price}</p>` : ''}
                    
                    <div class="flex space-x-3">
                        <button 
                            onclick="viewItem(${index})" 
                            class="flex-1 gradient-bg text-white py-3 px-4 rounded-xl font-semibold hover:scale-105 transition-transform duration-200"
                        >
                            üëÅÔ∏è Ver Detalhes
                        </button>
                        
                        <button 
                            onclick="removeItem(${index})" 
                            class="bg-red-500 text-white py-3 px-4 rounded-xl font-semibold hover:bg-red-600 transition-colors"
                        >
                            üóëÔ∏è
                        </button>
                    </div>
                    
                    ${item.completed ? 
                        `<div class="mt-4 text-center">
                            <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold">
                                ‚úÖ Comprado
                            </span>
                        </div>` : ''
                    }
                </div>
            `).join('');
        }

        // Fun√ß√£o para visualizar item no modal
        function viewItem(index) {
            const item = wishlistItems[index];
            currentModalItem = index;
            
            // Preencher o modal
            document.getElementById('modalTitle').textContent = item.title;
            
            if (item.price) {
                document.getElementById('modalPrice').textContent = item.price;
                document.getElementById('modalPrice').classList.remove('hidden');
            } else {
                document.getElementById('modalPrice').classList.add('hidden');
            }
            
            if (item.description) {
                document.getElementById('modalDescription').textContent = item.description;
                document.getElementById('modalDescription').classList.remove('hidden');
            } else {
                document.getElementById('modalDescription').classList.add('hidden');
            }
            
            if (item.image) {
                document.getElementById('modalImage').src = item.image;
                document.getElementById('modalImage').classList.remove('hidden');
                document.getElementById('modalNoImage').classList.add('hidden');
            } else {
                document.getElementById('modalImage').classList.add('hidden');
                document.getElementById('modalNoImage').classList.remove('hidden');
            }
            
            // Mostrar/esconder bot√£o de compra
            if (item.link) {
                document.getElementById('modalBuyButton').classList.remove('hidden');
            } else {
                document.getElementById('modalBuyButton').classList.add('hidden');
            }
            
            // Abrir modal
            document.getElementById('itemModal').classList.add('show');
        }

        // Fun√ß√£o para fechar modal
        function closeModal() {
            document.getElementById('itemModal').classList.remove('show');
            currentModalItem = null;
        }

        // Fun√ß√£o para abrir link de compra
        function openBuyLink() {
            if (currentModalItem !== null && wishlistItems[currentModalItem].link) {
                window.open(wishlistItems[currentModalItem].link, '_blank');
            }
        }

        // Fun√ß√£o para marcar como comprado
        async function markAsCompleted() {
            if (currentModalItem !== null) {
                try {
                    const item = wishlistItems[currentModalItem];
                    const newCompletedStatus = !item.completed;
                    
                    const { error } = await supabaseClient
                        .from('wishlist_items')
                        .update({ completed: newCompletedStatus })
                        .eq('id', item.id);

                    if (error) throw error;

                    // Atualizar localmente
                    item.completed = newCompletedStatus;
                    renderWishlist();
                    updateStats();
                    closeModal();
                    
                } catch (error) {
                    console.error('Erro ao atualizar status:', error);
                    alert('Erro ao atualizar status. Tente novamente.');
                }
            }
        }

        // Fun√ß√£o para remover um item
        async function removeItem(index) {
            if (confirm('Tem certeza que deseja remover este item?')) {
                try {
                    const item = wishlistItems[index];
                    
                    const { error } = await supabaseClient
                        .from('wishlist_items')
                        .delete()
                        .eq('id', item.id);

                    if (error) throw error;

                    // Remover localmente
                    wishlistItems.splice(index, 1);
                    renderWishlist();
                    updateStats();
                    
                } catch (error) {
                    console.error('Erro ao remover item:', error);
                    alert('Erro ao remover item. Tente novamente.');
                }
            }
        }

        // Fun√ß√£o para atualizar estat√≠sticas
        function updateStats() {
            const totalItems = wishlistItems.length;
            const completedItems = wishlistItems.filter(item => item.completed).length;
            
            // Calcular valor total
            let totalValue = 0;
            wishlistItems.forEach(item => {
                if (item.price) {
                    const price = item.price.replace(/[^\d,]/g, '').replace(',', '.');
                    if (!isNaN(parseFloat(price))) {
                        totalValue += parseFloat(price);
                    }
                }
            });
            
            document.getElementById('totalItems').textContent = totalItems;
            document.getElementById('completedItems').textContent = completedItems;
            document.getElementById('totalValue').textContent = `R$ ${totalValue.toFixed(2).replace('.', ',')}`;
        }

        // Fun√ß√µes auxiliares para categorias
        function getCategoryIcon(category) {
            const icons = {
                'eletronicos': 'üéÆ',
                'roupas': 'üëï',
                'livros': 'üìö',
                'casa': 'üè†',
                'esportes': '‚öΩ',
                'beleza': 'üíÑ',
                'outros': 'üéÅ'
            };
            return icons[category] || 'üéÅ';
        }

        function getCategoryName(category) {
            const names = {
                'eletronicos': 'Eletr√¥nicos',
                'roupas': 'Roupas',
                'livros': 'Livros',
                'casa': 'Casa',
                'esportes': 'Esportes',
                'beleza': 'Beleza',
                'outros': 'Outros'
            };
            return names[category] || 'Outros';
        }

        // Fun√ß√µes de filtro
        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            
            let filteredItems = wishlistItems.filter(item => {
                // Filtro por texto
                const matchesSearch = !searchTerm || 
                    item.title.toLowerCase().includes(searchTerm) ||
                    (item.description && item.description.toLowerCase().includes(searchTerm));
                
                // Filtro por categoria
                const matchesCategory = !categoryFilter || item.category === categoryFilter;
                
                // Filtro por status
                const matchesStatus = !statusFilter || 
                    (statusFilter === 'available' && !item.completed) ||
                    (statusFilter === 'completed' && item.completed);
                
                return matchesSearch && matchesCategory && matchesStatus;
            });
            
            renderFilteredItems(filteredItems);
        }

        function renderFilteredItems(filteredItems) {
            const grid = document.getElementById('wishlistGrid');
            const emptyState = document.getElementById('emptyState');
            
            if (filteredItems.length === 0) {
                grid.classList.add('hidden');
                emptyState.classList.remove('hidden');
                emptyState.innerHTML = `
                    <div class="text-8xl mb-6">üîç</div>
                    <h3 class="text-3xl font-bold text-red-600 mb-4">
                        Nenhum item encontrado
                    </h3>
                    <p class="text-xl text-gray-600">
                        Tente ajustar os filtros ou adicionar novos itens!
                    </p>
                `;
                return;
            }
            
            grid.classList.remove('hidden');
            emptyState.classList.add('hidden');
            
            grid.innerHTML = filteredItems.map((item, index) => `
                <div class="bg-white rounded-3xl shadow-lg p-6 border border-red-100 card-hover fade-in ${item.completed ? 'opacity-60' : ''}">
                    ${item.image ? 
                        `<img src="${item.image}" alt="${item.title}" class="w-full h-48 object-cover rounded-2xl mb-4 border-2 border-red-100" onerror="this.style.display='none'">` : 
                        `<div class="w-full h-48 bg-red-50 rounded-2xl mb-4 flex items-center justify-center border-2 border-red-100">
                            <svg class="w-16 h-16 text-red-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                        </div>`
                    }
                    
                    <h3 class="text-xl font-bold text-red-600 mb-3 ${item.completed ? 'line-through' : ''}">
                        ${item.title}
                    </h3>
                    
                    <!-- Categoria -->
                    <div class="mb-3">
                        <span class="inline-block bg-red-100 text-red-800 px-3 py-1 rounded-2xl text-sm font-semibold">
                            ${getCategoryIcon(item.category)} ${getCategoryName(item.category)}
                        </span>
                    </div>
                    
                    ${item.description ? `<p class="text-gray-600 mb-3 line-clamp-2">${item.description}</p>` : ''}
                    
                    ${item.price ? `<p class="text-lg font-bold text-red-600 mb-4">${item.price}</p>` : ''}
                    
                    <div class="flex space-x-3">
                        <button 
                            onclick="viewItem(${index})" 
                            class="flex-1 gradient-bg text-white py-3 px-4 rounded-xl font-semibold hover:scale-105 transition-transform duration-200"
                        >
                            üëÅÔ∏è Ver Detalhes
                        </button>
                        
                        <button 
                            onclick="removeItem(${index})" 
                            class="bg-red-500 text-white py-3 px-4 rounded-xl font-semibold hover:bg-red-600 transition-colors"
                        >
                            üóëÔ∏è
                        </button>
                    </div>
                    
                    ${item.completed ? 
                        `<div class="mt-4 text-center">
                            <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold">
                                ‚úÖ Comprado
                            </span>
                        </div>` : ''
                    }
                </div>
            `).join('');
        }

        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('statusFilter').value = '';
            renderWishlist();
        }

        // Event listener para o formul√°rio
        document.getElementById('addItemForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newItem = {
                title: document.getElementById('itemTitle').value.trim(),
                description: document.getElementById('itemDescription').value.trim(),
                price: document.getElementById('itemPrice').value.trim(),
                image: document.getElementById('itemImage').value.trim(),
                link: document.getElementById('itemLink').value.trim(),
                category: document.getElementById('itemCategory').value
            };
            
            if (newItem.title && newItem.category) {
                addWishItem(newItem);
                this.reset();
            } else if (!newItem.category) {
                alert('Por favor, selecione uma categoria!');
            }
        });

        // Fechar modal ao clicar fora
        document.getElementById('itemModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Event listeners para filtros em tempo real
        document.getElementById('searchInput').addEventListener('input', applyFilters);
        document.getElementById('categoryFilter').addEventListener('change', applyFilters);
        document.getElementById('statusFilter').addEventListener('change', applyFilters);

        // Carregar a lista quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', loadWishlistFromSupabase);
    </script>
</body>
</html>
